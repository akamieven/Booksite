<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مكتبة الاقتباسات</title>

  <!-- خطوط -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="page">
    <header class="site-header">
      <div class="brand">
        <div class="logo">م</div>
        <div class="brand-text">
          <div class="title">مكتبة الاقتباسات</div>
          <div class="subtitle">اقتباسات من كتب مع مرجع موحّد</div>
        </div>
      </div>

      <div class="controls">
        <div class="search-wrap">
          <input id="searchInput" class="search" placeholder="ابحث عن اقتباس أو كتاب أو وسم..." aria-label="بحث">
        </div>
        <div class="header-actions">
          <button id="randomBtn" class="btn">عشوائي</button>
          <button id="readerToggle" class="btn outline">قراءة</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="hero">
        <div class="hero-quote" id="featuredQuote">هنا يظهر اقتباس اليوم المميز</div>
        <div class="hero-meta" id="featuredMeta">اسم الكتاب — السنة</div>
      </section>

      <section class="books-section">
        <h3>الكتب</h3>
        <div id="booksList" class="books-list"></div>
      </section>

      <section class="quotes-section">
        <div class="section-head">
          <h3>الاقتباسات</h3>
          <div class="filters">
            <select id="bookFilter">
              <option value="">كل الكتب</option>
            </select>
            <select id="tagFilter">
              <option value="">كل الوسوم</option>
            </select>
          </div>
        </div>

        <div id="quotesGrid" class="grid"></div>
      </section>
    </main>

    <footer class="site-footer">© جميع الحقوق محفوظة — مكتبة الاقتباسات</footer>
  </div>

  <!-- مودال تفاصيل الاقتباس -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <strong>تفاصيل الاقتباس</strong>
        <button id="closeModal" class="icon-btn">×</button>
      </div>
      <div class="modal-body">
        <div id="modalQuote" class="modal-quote"></div>
        <div id="modalRef" class="modal-ref"></div>
        <div class="modal-actions">
          <button id="saveFav" class="btn outline">حفظ</button>
          <button id="copyBtn" class="btn">نسخ مع المرجع</button>
          <button id="openBook" class="btn outline">عرض الكتاب</button>
        </div>
        <div id="similarList" class="similar-list"></div>
      </div>
    </div>
  </div>

  <script src="scripts.js" type="module"></script>
</body>
</html>font-family:"Merriweather";font-size:18px}
    .quote-meta{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center;justify-content:space-between}
    .actions{display:flex;gap:8px}
    .icon-btn{background:transparent;border:1px solid #eee;padding:6px 8px;border-radius:8px;cursor:pointer;font-size:14px}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:60}
    .modal{background:var(--card);max-width:720px;width:100%;border-radius:12px;padding:18px}
    .modal .quote-large{font-family:"Merriweather";font-size:22px;margin-bottom:10px}
    .modal .ref{color:var(--muted);font-size:14px;margin-bottom:12px}

    /* footer */
    footer{margin-top:28px;padding:18px 0;color:var(--muted);font-size:14px;text-align:center}

    /* responsive */
    @media (max-width:720px){
      .hero{flex-direction:column;align-items:flex-start}
      .quote-text{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="mark">م</div>
        <div>
          <div class="site-title">مكتبة الاقتباسات</div>
          <div style="font-size:12px;color:var(--muted)">اقتباسات من كتب مع مرجع موحّد</div>
        </div>
      </div>

      <div class="search-wrap">
        <div class="search" role="search">
          <input id="searchInput" placeholder="ابحث عن اقتباس أو كتاب أو وسم..." aria-label="بحث">
          <button class="btn" id="randomBtn" title="اقتباس عشوائي">عشوائي</button>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button id="favToggle" class="icon-btn" title="المفضلات">المفضلات</button>
        <button id="readerToggle" class="icon-btn" title="وضع القراءة">قراءة</button>
      </div>
    </header>

    <main>
      <section class="hero" aria-labelledby="heroTitle">
        <div>
          <div class="quote" id="featuredQuote">مثال اقتباس مميز يظهر هنا لليوم</div>
          <div class="meta" id="featuredMeta">المرجع — اسم الكتاب (سنة)</div>
        </div>
      </section>

      <div>
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h3 style="margin:0">الكتب</h3>
          <div style="color:var(--muted);font-size:14px">تصفّح حسب الكتاب</div>
        </div>
        <div class="books" id="booksList"></div>
      </div>

      <section style="margin-top:18px">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h3 style="margin:0">أحدث الاقتباسات</h3>
          <div style="display:flex;gap:8px;align-items:center">
            <label style="font-size:14px;color:var(--muted)">فلتر الوسم</label>
            <select id="tagFilter">
              <option value="">الكل</option>
            </select>
          </div>
        </div>

        <div class="grid" id="quotesGrid"></div>
      </section>
    </main>

    <footer>© جميع الحقوق محفوظة — مكتبة الاقتباسات</footer>
  </div>

  <!-- نافذة التفاصيل -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>تفاصيل الاقتباس</strong>
        <button id="closeModal" class="icon-btn">إغلاق</button>
      </div>
      <div style="height:12px"></div>
      <div class="quote-large" id="modalQuote">نص الاقتباس</div>
      <div class="ref" id="modalRef">المرجع</div>
      <div style="display:flex;gap:8px">
        <button id="saveFav" class="icon-btn">حفظ للمفضلة</button>
        <button id="copyBtn" class="icon-btn">نسخ مع المرجع</button>
        <button id="openBook" class="icon-btn">عرض الكتاب</button>
      </div>
      <div style="height:10px"></div>
      <div id="similarList" style="color:var(--muted)"></div>
    </div>
  </div>

  <script>
    // بيانات تجريبية قابلة للاستبدال
    const booksData = [
      { id: 'b1', title: 'كتاب المثال الأول', year: 1999, cover: '' },
      { id: 'b2', title: 'كتاب المثال الثاني', year: 2005, cover: '' },
      { id: 'b3', title: 'كتاب المثال الثالث', year: 2018, cover: '' }
    ];

    const quotesData = [
      { id:'q1', text:'مثال اقتباس قصير يوضح الشكل العام للبطاقة', bookId:'b1', chapter:'الفصل 2', page:45, tags:['حكمة','حياة'] },
      { id:'q2', text:'سطر مقتبس آخر لتجربة العرض على الهاتف والحاسوب', bookId:'b2', chapter:'المقدمة', page:12, tags:['تفكير'] },
      { id:'q3', text:'اقتباس ثالث يوضح اقتباسات طويلة نسبياً يمكن تقليصها', bookId:'b1', chapter:'الفصل 5', page:201, tags:['حكمة','حب'] },
      { id:'q4', text:'مقولة قصيرة وجذابة للاختبار', bookId:'b3', chapter:'الفصل 1', page:5, tags:['إلهام'] }
    ];

    // عناصر DOM
    const booksList = document.getElementById('booksList');
    const quotesGrid = document.getElementById('quotesGrid');
    const featuredQuote = document.getElementById('featuredQuote');
    const featuredMeta = document.getElementById('featuredMeta');
    const searchInput = document.getElementById('searchInput');
    const tagFilter = document.getElementById('tagFilter');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalQuote = document.getElementById('modalQuote');
    const modalRef = document.getElementById('modalRef');
    const closeModal = document.getElementById('closeModal');
    const saveFav = document.getElementById('saveFav');
    const copyBtn = document.getElementById('copyBtn');
    const openBook = document.getElementById('openBook');
    const randomBtn = document.getElementById('randomBtn');
    const favToggle = document.getElementById('favToggle');
    const readerToggle = document.getElementById('readerToggle');
    const similarList = document.getElementById('similarList');

    // حالة
    let currentQuote = null;
    let favorites = JSON.parse(localStorage.getItem('quotes_favs') || '[]');

    // تهيئة الكتب
    function renderBooks(){
      booksList.innerHTML = '';
      booksData.forEach(b=>{
        const el = document.createElement('div');
        el.className = 'book-card';
        el.innerHTML = `
          <div class="book-cover" aria-hidden="true">${b.cover ? '' : ''}</div>
          <div style="flex:1">
            <div style="font-weight:600">${b.title}</div>
            <div style="font-size:13px;color:var(--muted)">${b.year}</div>
          </div>
        `;
        el.addEventListener('click', ()=> filterByBook(b.id));
        booksList.appendChild(el);
      });
    }

    // تجميع الوسوم
    function populateTags(){
      const tags = new Set();
      quotesData.forEach(q=> q.tags.forEach(t=> tags.add(t)));
      tagFilter.innerHTML = '<option value="">الكل</option>';
      Array.from(tags).forEach(t=>{
        const opt = document.createElement('option'); opt.value=t; opt.textContent=t; tagFilter.appendChild(opt);
      });
    }

    // عرض شبكة الاقتباسات
    function renderQuotes(list = quotesData){
      quotesGrid.innerHTML = '';
      list.forEach(q=>{
        const book = booksData.find(b=>b.id===q.bookId) || {};
        const card = document.createElement('article');
        card.className = 'quote-card';
        card.innerHTML = `
          <div class="quote-text">${q.text}</div>
          <div class="quote-meta">
            <div>${book.title || 'كتاب غير معروف'} — ${q.chapter || ''}</div>
            <div class="actions">
              <button class="icon-btn" data-id="${q.id}" data-action="open">عرض</button>
              <button class="icon-btn" data-id="${q.id}" data-action="fav">${favorites.includes(q.id) ? 'محفوظ' : 'حفظ'}</button>
            </div>
          </div>
        `;
        quotesGrid.appendChild(card);
      });
    }

    // فتح نافذة تفاصيل
    function openModalFor(id){
      const q = quotesData.find(x=>x.id===id);
      if(!q) return;
      currentQuote = q;
      modalQuote.textContent = q.text;
      const book = booksData.find(b=>b.id===q.bookId) || {title:'كتاب غير معروف', year:''};
      modalRef.textContent = `${book.title} — ${book.year}. ${q.chapter ? q.chapter + '.' : ''} ${q.page ? 'صفحة ' + q.page + '.' : ''}`;
      modalBackdrop.style.display = 'flex';
      modalBackdrop.setAttribute('aria-hidden','false');
      renderSimilar(q);
    }

    // إغلاق المودال
    closeModal.addEventListener('click', ()=> {
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
    });
    modalBackdrop.addEventListener('click', (e)=> {
      if(e.target === modalBackdrop) { closeModal.click(); }
    });

    // حفظ للمفضلة
    saveFav.addEventListener('click', ()=>{
      if(!currentQuote) return;
      toggleFav(currentQuote.id);
      saveFav.textContent = favorites.includes(currentQuote.id) ? 'محفوظ' : 'حفظ للمفضلة';
      renderQuotes();
    });

    // نسخ مع المرجع
    copyBtn.addEventListener('click', ()=>{
      if(!currentQuote) return;
      const book = booksData.find(b=>b.id===currentQuote.bookId) || {};
      const text = `"${currentQuote.text}" — ${book.title || ''} (${book.year || ''}) ${currentQuote.page ? 'صفحة ' + currentQuote.page : ''}`;
      navigator.clipboard.writeText(text).then(()=> {
        copyBtn.textContent = 'تم النسخ';
        setTimeout(()=> copyBtn.textContent = 'نسخ مع المرجع',1200);
      });
    });

    // فتح صفحة الكتاب (تصفية)
    openBook.addEventListener('click', ()=>{
      if(!currentQuote) return;
      filterByBook(currentQuote.bookId);
      closeModal.click();
    });

    // تفعيل أزرار الشبكة
    quotesGrid.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;
      if(action === 'open') openModalFor(id);
      if(action === 'fav') { toggleFav(id); renderQuotes(); }
    });

    // تبديل المفضلات
    function toggleFav(id){
      if(favorites.includes(id)) favorites = favorites.filter(x=>x!==id);
      else favorites.push(id);
      localStorage.setItem('quotes_favs', JSON.stringify(favorites));
    }

    // فلترة حسب الكتاب
    function filterByBook(bookId){
      const filtered = quotesData.filter(q=>q.bookId === bookId);
      renderQuotes(filtered);
      window.scrollTo({top:220,behavior:'smooth'});
    }

    // بحث ذكي
    searchInput.addEventListener('input', (e)=>{
      const v = e.target.value.trim().toLowerCase();
      if(!v){ renderQuotes(); return; }
      const filtered = quotesData.filter(q=>{
        const book = (booksData.find(b=>b.id===q.bookId) || {}).title || '';
        return q.text.toLowerCase().includes(v) || book.toLowerCase().includes(v) || q.tags.join(' ').toLowerCase().includes(v);
      });
      renderQuotes(filtered);
    });

    // فلتر الوسم
    tagFilter.addEventListener('change', ()=>{
      const v = tagFilter.value;
      if(!v) renderQuotes();
      else renderQuotes(quotesData.filter(q=> q.tags.includes(v)));
    });

    // اقتباس عشوائي
    randomBtn.addEventListener('click', ()=>{
      const idx = Math.floor(Math.random()*quotesData.length);
      const q = quotesData[idx];
      featuredQuote.textContent = q.text;
      const book = booksData.find(b=>b.id===q.bookId) || {};
      featuredMeta.textContent = `${book.title || ''} — ${book.year || ''}`;
      openModalFor(q.id);
    });

    // وضع القراءة (عرض اقتباس مميز فقط)
    readerToggle.addEventListener('click', ()=>{
      document.body.classList.toggle('reader-mode');
      readerToggle.textContent = document.body.classList.contains('reader-mode') ? 'خروج من القراءة' : 'قراءة';
    });

    // عرض مشابهات
    function renderSimilar(q){
      const sims = quotesData.filter(x=> x.id !== q.id && x.bookId === q.bookId).slice(0,4);
      if(sims.length === 0) similarList.textContent = '';
      else {
        similarList.innerHTML = '<strong>اقتباسات من نفس الكتاب</strong><ul style="margin:8px 0 0 0;padding:0 0 0 12px"></ul>';
        const ul = similarList.querySelector('ul');
        sims.forEach(s=>{
          const li = document.createElement('li');
          li.style.marginBottom = '6px';
          li.innerHTML = `<a href="#" data-id="${s.id}" class="sim-link">${s.text}</a>`;
          ul.appendChild(li);
        });
        // روابط مشابهة
        similarList.querySelectorAll('.sim-link').forEach(a=>{
          a.addEventListener('click', (ev)=>{
            ev.preventDefault();
            openModalFor(a.dataset.id);
          });
        });
      }
    }

    // تهيئة أولية
    function init(){
      renderBooks();
      populateTags();
      renderQuotes();
      // اقتباس مميز افتراضي
      const first = quotesData[0];
      if(first){
        featuredQuote.textContent = first.text;
        const book = booksData.find(b=>b.id===first.bookId) || {};
        featuredMeta.textContent = `${book.title || ''} — ${book.year || ''}`;
      }
    }

    init();
  </script>
</body>
</html>