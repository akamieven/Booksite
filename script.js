(async () => {
    // استيراد بيانات الكتاب ديناميكيا (من ملف JSON مستقبلاً)
    const authorsData = [
        {
            id: 1,
            name: "غسان كنفاني",
            image: "https://i.postimg.cc/054GzSS1/5b2cc74e67c83d85a860d5c9ff81c0d4.jpg",
            bio: `غسان كنفاني (عكا 9 أبريل 1936 - بيروت 8 يوليو 1972) هو روائي وقاص وصحفي فلسطيني، ويعتبر أحد أشهر الكتاب والصحافيين العرب في القرن العشرين. فقد كانت أعماله الأدبية من روايات وقصص قصيرة متجذرة في عمق الثقافة العربية والفلسطينية. ولد في عكا، شمال فلسطين، في التاسع من نيسان عام 1936م، وعاش في يافا حتى أيار 1948 حين أجبر على اللجوء مع عائلته في بادئ الأمر إلى لبنان ثم إلى سوريا. عاش وعمل في دمشق ثم في الكويت وبعد ذلك في بيروت منذ 1960 وفي تموز 1972، استشهد في بيروت مع ابنة أخته لميس في انفجار سيارة مفخخة على أيدي عملاء إسرائيليين.

أصدر غسان كنفاني حتى تاريخ وفاته المبكّر ثمانية عشر كتاباً، وكتب مئات المقالات والدراسات في الثقافة والسياسة وكفاح الشعب الفلسطيني. في أعقاب اغتياله تمّت إعادة نشر جميع مؤلفاته بالعربية، في طبعات عديدة. وجمعت رواياته وقصصه القصيرة ومسرحياته ومقالاته ونشرت في أربعة مجلدات. وتُرجمت معظم أعمال غسان الأدبية إلى سبع عشرة لغة ونُشرت في أكثر من 20 بلداً، وتمّ إخراج بعضها في أعمال مسرحية وبرامج إذاعية في بلدان عربية وأجنبية عدة. اثنتان من رواياته تحولتا إلى فيلمين سينمائيين. وما زالت أعماله الأدبية التي كتبها بين عامي 1956 و1972 تحظى اليوم بأهمية متزايدة.

على الرغم من أن روايات غسان وقصصه القصيرة ومعظم أعماله الأدبية الأخرى قد كتبت في إطار قضية فلسطين وشعبها فإن مواهبه الأدبية الفريدة أعطتها جاذبية عالمية شاملة. `,
            quotes: [
                { text: `لقد اهترأت هذه الأقوال العتيقة، هذه المعادلات الحسابية المترعة بالأخاديع.. مرة تقولون أن أخطاءنا تبرر أخطاءكم، ومرة تقولون أن الظلم لا يصحح بظلم آخر.. تستخدمون المنطق الأول لتبرير وجودكم هنا، وتستخدمون المنطق الثاني لتتجنبوا العقاب الذي تستحقونه.. ويخيل إليَّ أنكم تتمتعون الى أقصى حد بهذه اللعبة الطريفة.. وها أنت تحاول مرة جديدة أن تجعل من ضعفنا حصان الطراد الذي تعتلي صهوته.. لا، أنا لا أتحدث إليك مفترضًا أنك عربي، والآن أنا أكثر من يعرف أن الإنسان هو قضية، وليس لحمًا ودمًا يتوارثه جيلٌ وراءَ جيلٍ مثلما يتبادل البائعُ والزبون معلباتِ اللحمِ المقدَّد؛ إنما أتحدث إليك مفترضًا أنك في نهاية الأمر إنسان.. يهودي.. أو فلتكن ما تشاء.. ولكن عليك أن تدرك الأشياء كما ينبغي.. وأنا أعرف أنك ذات يوم ستدرك هذه الأشياء، وتدرك أن أكبر جريمة يمكن لأي إنسان أن يرتكبها، كائنًا من كان، هي أن يعتقد ولو للحظة أن ضعف الآخرين وأخطاءهم هي التي تشكل حقه في الوجود على حسابهم، وهي التي تبرر له أخطاءه وجرائمه..`, book: "عائد إلى حيفا" },
                { text: `- أتعرفين؟ طوال عشرين سنة كنت أتصور أن بوابة "مندلبوم" ستفتح ذات يوم.. ولكن أبدًا أبدًا لم أتصور أنها ستفتح من الناحية الأخرى.. لم يكن ذلك يخطر لي على بال، ولذلك فحين فتحوها هم بدا لي الأمر مرعبًا وسخيفًا وإلى حد كبير مهينًا تمامًا... قد أكون مجنونًا لو قلت لك أن كل الأبواب يجب ألا تفتح إلا من جهة واحدة، وإنها إذا فتحت من الجهة الأخرى فيجب اعتبارها مغلقة لا تزال، ولكن تلك هي الحقيقة..`, book: "عائد إلى حيفا" }
            ]
        },
        {
            id: 2,
            name: "ستيفان زفايغ",
            image: "https://i.postimg.cc/Y9cMsbG3/50e7371c9c64fc9848057668a1310b16.jpg",
            bio: `شتيفان تسفايغ (بالألمانية: Stefan Zweig) (28 نوفمبر 1881 ـ 22
            فبراير 1942) هو أديب وكاتب نمساوي ذو خلفية يهودية. ومن أبرز كتّاب
            أوروبا في بدايات القرن العشرين. ولد زفايج في فيينا التي كانت عاصمةً
            لإمبراطورية النمسا-المجر، لأسرة إيدا بريتاور (1854-1938)، وهي ابنة
            لعائلة مصرفية يهودية، وموريتز تسفايج (1845-1926)، وهو صانع نسيج
            يهودي ثري. درس زفايج الفلسفة في جامعة فيينا وفي عام 1904 حصل على
            درجة الدكتوراه بأطروحته حول "فلسفة إيبوليت تين ". تزوج تسفايغ من
            فريدريكه ماريا فون وينترنيتز (ولدت بورغر) في عام 1920 وانفصلا في عام
            1938/ وقد نشرت فريدريكه كتابًا عن زوجها السابق بعد وفاته، ونشرت
            لاحقًا كتابًا ثانيًا مصورًا عن زفايج. وفي أواخر صيف عام 1939، تزوج
            زفايج من سكرتيرته إليزابيت شارلوته "لوته" ألتمان في باث بإنجلترا.
            بلغ تسفايغ شهرة عالمية في عشرينيات وثلاثينيات القرن العشرين، وكان
            صديقًا لآرثر شنيتزلر وسيغموند فرويد، وحظي بشعبية كبيرة في الولايات
            المتحدة وأمريكا الجنوبية وأوروبا القارية (بخلاف بريطانيا حيث لم يلق
            رواجا واسعا). في فترة ما نُشرت أعماله باللغة الإنجليزية دون موافقته
            تحت الاسم المستعار "ستيفن برانش" (ترجمة انكليزية لاسم عائلته تسفايغ)
            عندما كانت المشاعر المعادية لألمانيا تتزايد. في عام 1934، بعد صعود
            هتلر إلى السلطة في ألمانيا وقيام نظام النمسا الاتحادية، وهو نظام
            سياسي استبدادي يُعرف الآن باسم "الفاشية النمساوية"، غادر زفايج
            النمسا إلى إنجلترا، وعاش أولاً في لندن، ثم انتقل في عام 1939 إلى
            باث. وقد ورد اسمه في القائمة التي أعدها النازيون ضمن الاستعدادات
            لعملية أسد البحر لغزو بريطانيا، وفيها أسماء وعناوين من سيلقى القبض
            عليهم فور غزو الجزر البريطانية، حيث يرد اسمه وعنوانه في بريطانيا في
            الصفحة 231 مما سمي بالكتاب الأسود. كان تسفايغ صديقًا مقربًا للموسيقي
            ريتشارد شتراوس، وقدم له ليبريتو أوبرا " المرأة الصامتة" (بالألمانية:
            Die schweigsame Frau)، وقد تحدى شتراوس النظام النازي برفضه الموافقة
            على إزالة اسم تسفايغ من البرنامج في العرض الافتتاحي في دريسدن يوم 24
            يونيو 1935، وقد أدى هذا الرفض إلى سحب وزير الدعاية يوزف غوبلز
            موافقته على الحضور، وإلى حظر الأوبرا نفسها ثلاثة عروض. تعاون تسفايغ
            بعد لجوئه إلى بريطانيا مع الكاتب جوزيف غريغور لتزويد شتراوس بنص
            الأوبرا الثانية "دافنه"(بالألمانية: Daphne) في عام 1937. كما لحن
            الموسيقي وعازف البيانو هنري جولس الذي فر مثل زفايج إلى البرازيل
            هربًا من النازيين، قام بتأليف أغنية "قصيدة تسفايغ الأخيرة
            (بالإسبانية: Último poema de Stefan Zweig)، على أرضية قصيدةبنفس
            الاسم (بالألمانية: Letztes Gedicht) كتبها تسفايغ في عام 1941 في عيد
            ميلاده الستين في عام 1940 عبر تسفايغ وزوجته الثانية المحيط الأطلسي
            إلى الولايات المتحدة، وسكنا في نيويورك، ثم عاشا لمدة شهرين ضيوفا على
            جامعة ييل في نيو هيفن، كونيتيكت، قبل استئجار منزل في أوسينينغ في
            ولاية نيويورك. في 22 أغسطس 1940، انتقلوا مرة أخرى إلى بتروبوليس في
            البرازيل، وهي بلدة جبلية يستوطنها ذوو الأصول الألمانية، تقع على بعد
            68 كيلومترًا شمال العاصمة ريو دي جانيرو. وهناك كتب كتاب البرازيل أرض
            المستقبل، وهو مجموعة مقالات عن تاريخ وثقافة البلد، كما طور صداقة
            وثيقة مع الشاعرة التشيلية غابرييلا ميسترال. في تلك الفترة كتب زفايج،
            الذي شعر بالاكتئاب المتزايد بشأن الوضع في أوروبا ومستقبل البشرية، في
            رسالة إلى الكاتب الفرنسي جول رومان، "تكمن أزمتي الداخلية في أنني غير
            قادر على التعرف على نفسي في "أنا" جواز السفر، و"نفس" المنفى"،
            واعتراه اليأس من مستقبل أوروبا وثقافتها. انتحر مع زوجته في 21 فبراير
            عام 1942 في منزلهما في بتروبوليس بتناول جرعة كبيرة من الأقراض
            المنومة، وقد ترك رسالة يشرح فيها أسباب انتحاره، وهي خيبة الأمل
            واليأس من مستقبل أوروبا ظل انهيار السلام العالمي وويلات الحرب
            العالمية الثانية، ويشكر حكومة البرازيل حيث انتحر على حسن الضيافة،
            وقد كتب في ذلك اليوم 192 رسالة وداع بما في ذلك رسالة إلى زوجته
            الأولى.`,
            quotes: [
                { text: `لقد كانوا يعذبوننا بالعزلة، عزلة خالصة لا يمكن أن تخطر
                على بال أحد. لم نتعرّض لأي تعذيب جسدي... بل أسلمونا ببساطة إلى
                فراغ مطلق، ومن البديهي أن لا شيء في العالم يعذب النفس البشرية
                أكثر من الفراغ.`, book: "لاعب الشطرنج" },
                { text: `انطبع على شفتيّ طعمٌ مر، طعم تفاهةِ الحياة البشريّة. ما
                جدوى العيش إذا كانت الريح سَتُذري خلف أقدامنا آخرَ أثرٍ لمرورنا؟
                على مدى أكثر من ثلاثين عامًا، وربما أربعين، ثمّة رجل قد تنفس
                هنا، قرأ وفكّر في هذه الأمتار المربّعة القليلة، ثم حلّت ثلاثة
                أعوام أو أربعة، جاء فيها فرعون جديد آخر فكانت كافية لمحو جاكوب
                مانديل من الذاكرة.`,
                book: "مانديل بائع الكتب القديمة" }
            ]
        }
        
    ];

    // DOM Nodes
    
    const container = document.getElementById('authorsContainer');
    const modal = document.getElementById('authorModal');
    const modalBody = document.getElementById('modalBody');
    const closeModalBtn = document.getElementById('closeModal');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const searchInput = document.getElementById('searchInput');

    // إنشاء التنبيه (Toast)
    const toast = document.createElement('div');
    toast.className = 'copy-toast';
    toast.textContent = 'تم نسخ النص!';
    document.body.appendChild(toast);

    // 3. عرض الكُتّاب
    const renderAuthors = (filter = '') => {
        container.innerHTML = '';
        const authors = authorsData.filter(author =>
            author.name.toLowerCase().includes(filter.toLowerCase())
        );

        if (authors.length === 0) {
            container.innerHTML = '<p style="grid-column: 1/-1; text-align:center; padding: 2rem; color: var(--text-secondary);">لا توجد نتائج.</p>';
            return;
        }

        authors.forEach(author => {
            const card = document.createElement('div');
            card.className = 'author-card';
            card.innerHTML = `
                <img class="author-img" src="${author.image}" alt="${author.name}" loading="lazy">
                <h3 class="author-name">${author.name}</h3>
            `;
            card.addEventListener('click', () => openModal(author));
            container.appendChild(card);
        });
    };

    // 4. فتح النافذة (تم التعديل: البايو متصل + إصلاح زر النسخ)
    const openModal = (author) => {
        
        // تعديل: عرض البايو كما هو بدون فواصل إجبارية ليظهر متواصلاً
        const bioText = author.bio; 
        
        modalBody.innerHTML = `
            <div class="modal-header">
                <img class="modal-avatar" src="${author.image}" alt="${author.name}">
                <h2 id="modalTitle">${author.name}</h2>
                <p id="modalDescription" style="line-height: 1.8; text-align: justify;">${bioText}</p>
            </div>
            <div class="modal-quotes">
                <h3>أبرز الإقتباسات</h3>
                ${author.quotes.map(quote => {
                    // نضع النص داخل data-text لتجنب تكسر الكود بسبب علامات التنصيص
                    // يتم استبدال علامة التنصيص المزدوجة فقط لحماية HTML
                    const safeQuoteForAttr = quote.text.replace(/"/g, '&quot;');
                    
                    return `
                    <div class="quote-box">
                        <p class="quote-text">"${quote.text}"</p>
                        <small class="quote-source">— ${quote.book || 'مصدر غير محدد'}</small>
                        
                        <button class="copy-btn" data-text="${safeQuoteForAttr}" title="نسخ النص">
                            <span class="material-symbols-outlined">content_copy</span>
                        </button>
                    </div>
                `}).join('')}
            </div>
        `;
        
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
    };

    // 5. التعامل مع زر النسخ (طريقة جديدة وآمنة)
    // نستمع لأي ضغطة في المستند، إذا كانت على زر نسخ نقوم بالعملية
    document.addEventListener('click', (e) => {
        // البحث عن أقرب زر نسخ تم الضغط عليه
        const btn = e.target.closest('.copy-btn');
        if (!btn) return; // إذا لم يكن الضغط على زر نسخ، تجاهل الأمر

        const textToCopy = btn.getAttribute('data-text');
        
        navigator.clipboard.writeText(textToCopy).then(() => {
            // تأثير النجاح
            const icon = btn.querySelector('span');
            const originalIcon = icon.textContent;
            
            icon.textContent = 'check_circle';
            icon.style.color = '#4caf50';

            toast.classList.add('show');

            setTimeout(() => {
                icon.textContent = originalIcon;
                icon.style.color = '';
                toast.classList.remove('show');
            }, 2000);
        }).catch(err => {
            console.error('فشل النسخ', err);
        });
    });

    // 6. إغلاق النافذة
    const closeModal = () => {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
    };

    // 7. الثيم الليلي
    const toggleTheme = () => {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        themeIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    // التشغيل المبدئي
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            themeIcon.textContent = 'light_mode';
        }
        renderAuthors();
    });

    closeModalBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => e.target === modal && closeModal());
    themeToggle.addEventListener('click', toggleTheme);
    searchInput.addEventListener('input', (e) => renderAuthors(e.target.value));

})();